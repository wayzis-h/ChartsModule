# Charts module

Необходимо реализовать сервис который будет хранить данные о торгах.
Данные представляют из себя однотипные записи из 5-и значений типа
decimal, timestamp (начало бара), строки (Торговой пары),
и строки до 3 символов (Размер/длительность одного бара. Пример: 1y, 4h, 15m, 5s)

В основной функционал входит:
- Хранение данных
- Добавление новых данных, исходя из полученных торговых данных
- Предоставление данных в виде набора баров по запросу другого сервиса

## Основное

### Термины

bar (Бар) - один "Столбец" графика

Один бар хранит в себе: минимальную и максимальную цену, цены открытия и закрытия, объём торгов за заданный период.

Минимальная и максимальная цена - минимальные/максимальные цены которые были достигнуты за промежуток этого бара

Цена открытия - цена первой сделки в этом баре

Цена закрытия - цена последней сделки в этом баре

### Условия

- Возможность масштабирования графиков вне зависимости от того как они хранятся.
При инициализации сервиса можно задать конфигурационный файл, с доступными временными интервалами для баров.
- Возможность хранить графики по нескольким торговым парам
- Данные хранятся в формате OHLCV
(OpenHighLowCloseVolume, Цена открытия + Наибольшая цена + Наименьшая цена + Цена закрытия + Объём торгов)

### Алгоритмические тонкости

#### Масштабирование графиков

Стоит хранить сразу несколько форматов графиков на одну торговую пару,
например на 15 минут, 1 час, 4 часа, и 12 часов.

Если пользователь захочет 30-минутные графики - берутся 15-и минутные графики по двое и объединяются.

#### "Пустые" данные

Если торговые данные не поступают - в идеале ничего не записывать в базу.

При запросе данных через метод getChart пустые строки игнорируются алгоритмом "Сбора графика".

## Методы

### getChart

Получение графика

Параметры:
- Торговая пара (string)
- Размер бара (string: 15min, 1h, 1d и т.д.)
- Начальная дата (timestamp)
- Конечная дата (timestamp)
В случае превышения допустимого лимита по количеству баров
(Например, был выбран промежуток в 100 дней и часовые бары = 2400 баров за запрос)
возвращается максимально допустимое количество баров от начальной даты.

### addTradeData

Добавление торговых данных
*Рекомендуется реализовать с помощью брокера очередей*

При добавлении торговых данных необходимо менять данные во всех барах
в промежуток которых входят полученные торговые данные.

Например: в базе имеются бары по 15min,
а торговые данные получены за время 16:08 - значит их нужно внести в бар 16:00-16:15.

При внесении данных, нужно обновить:

- Цену открытия (Если в этот бар ещё не добавлялись торговые данные)
- Цену закрытия (В любом случае)
- Максимальную цену (Если максимальная цена торговых данных выше чем максимальная цена в баре)
- Минимальную цену (Если максимальная цена из полученных данных ниже чем)

Параметры:

- Торговая пара (string)
- Объём исполненного ордера (Decimal)
- Цена исполненного ордера (Decimal)
- Время (timestamp)

### addPair

Добавление торговой пары

Метод вызывается администратором, при добавлении торговой пары в сервис.
После добавления пары, сервис подписывается на событие по заданной торговой паре в брокере очередей

Параметры:

- Торговая пара (string)

## Инструменты, которые стоит использовать

**RabbitMQ** - для получения торговых данных от модуля исполняющего ордера (Метод addTradeData)

**TimeSeries Database** - для хранения данных о торгах.
Можно использовать любую базу данных которая будет хорошо работать с большими и однотипными объёмами данных.
Я остановился на **InfluxDB**.